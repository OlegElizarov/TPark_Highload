# TPark_Highload

Курсовой проект
=================

В данном проекте будет рассмотрен почтовый сервис, который позволяет клиентам 
читать и отправлять письма, также имеется возможность отправки с различными вложенными файлами.


Часть 1. Определение возможного диапазона нагрузок
=================

Согласно [wikipedia](https://ru.wikipedia.org/wiki/Население_России) население России к 2020 году можно принять равным 
146млн человек.
А согласно [yandex.radar](https://radar.yandex.ru/yandex?month=2020-08) среднее количество уникальных пользователей 
Яндекс почты составляет примерно 17млн человек в месяц , что составляет 11% от населения России.
Согласно [similarweb](https://www.similarweb.com/website/mail.yandex.ru/) у почты Яндекса общее количество посещений в 
месяц примерно 400млн(У почты Mail.ru - более 540млн), со средним временем нахождения пользователя на сайте - 8 минут.
Общее количество активных аккаунтов почты mail.ru составляет [100млн](https://corp.mail.ru/ru/company/portal/)

Возможности пользователя, которые ему предоставляет почта:
* Регистрация
* Авторизация
* Постраничное получение списка последних писем
* Фильтрация писем
* Отправка и пересылка писем(Есть возможность прикреплять файлики до  25Мб [(Почта Яндекса)](https://yandex.ru/support/mail/web/letter/attachments.html) )
* Удаление писем

Учитывая дневную аудиторию Яндекс почты в [6.2 млн человек](https://radar.yandex.ru/yandex?month=2020-08), каждый из которых остается на сайте 
примерно 8(мы возьмем 5 для усреднения) минут, то ,можно провести эксперимент, предложив среднестатистическому 
пользователю провести на сайте почты это самое время.Используя вкладку network браузера , 
можно получить количество различных запросов, которые сгенерировал пользователь за это время равное - 500 штук.
```
RPS = (6.2*10^6 * 500)/(24*60*60) ~ 36000 
```

Часть 2. Выбор планируемой нагрузки
=================
Основываясь на цифрах из пункта 1, выберем целевые цифры для нашего проекта равными:
* 5 млн уникальных пользователей в день
* 80 млн активных аккаунтов (54% населения России, 80%)
* Поддержка PRS = 30000 запросов в секунду

Часть 3. Логическая схема базы данных
=================
![](images/LogDB.png)

Часть 4. Физическая системы хранения
=================
В качестве СУБД будет использоваться [LevelDB](https://github.com/google/leveldb).
Для каждого пользователя на сервере с СУБД будет создана папка, в которой будут храниться все связанные с 
ним сущности.Это позволит получать сообщения пользователя, конкретно из его стораджа, а не из какой-то общей таблицы,
в которой будет миллионы сообщений, что очень замедлит поиск.Еще стоит отметить, что чаще всего мы хотим 
получать последовательный список сообщений, так что данная система хранения будет способствовать последовательному 
чтению с диска.
<br>
`WORK IN PROGRESS`

Часть 5. Выбор технологического стека проекта(кроме СУБД)
=================

**Бэкенд:** Главным языком для серверной разработки будет выбран Golang, который позволяет быстро и эффективно 
писать код.В его основе лежит теоретическая модель [CSP](https://en.wikipedia.org/wiki/Communicating_sequential_processes).

```
Scalling by adding more of the same

Golang UK Conference 2017 by Arne Claus
```

Она обеспечит хорошую масштабируемость Бэкенда, а также позволит избежать блокировок при конкурентном доступе. 
В основном код будет написан с использованием обширной стандартной библиотеки, роутером будет выбран 
[fasthttp](https://github.com/valyala/fasthttp), который показывает наилучшие показатели производительности.
Безусловно , нужно учитывать трудности со сборщиком мусора, который будет снижать производительность 
раз за какое-то  △t времени.Поэтому необходимо будет учитывать не только среднюю производительность , 
но и ее нижнюю границу.

**Фронтенд:** Выбор CSS,HTML,TypeScript/JavaScript , как технологий для фронтенд составляющей проекта будет
обусловлен их популярностью и изученностью годами.Для JavaScript существует уже огромное количество библиотек ,которые
как и упрощают вертску, так и способны влиять на производительность кода.TypeScript же способен и ускорить
разработку из-за отлавливания ошибок при компиляции, и обезопасить наш будущий код от непредсказуемого поведения.

**Протоколы:** В данном проекте подразумевается использование https и http2 для связи клиента с бэкендом.Также будет
реализована связь с помощью websocket протокола, для отображения новых пришедших пользователю сообщений(как пример)
в режиме реального времени.
Связь микросервисов на бэкенде будет осуществляться классическим для Golang'а способом -  через GRPS+Protobuf, что
является одним из самых эффективных способов общения как с точки зрения скорости, так и с точки зрения размера 
передаваемого трафика.

Часть 6. Расчет нагрузки и потребного оборудования
=================
